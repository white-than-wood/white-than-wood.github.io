---
title: hexoæ­å»ºnextåšå®¢
date: 2022-05-14 04:30:23
tags: [hexo,blog,next themes]
categories: hexo
---

# å¼•è¨€

   <b>æ­¤åšå®¢ç”¨äºæ­å»ºhexoçš„å·¥å…·åšå®¢.åŸºæœ¬ä¸ä¼šæ¢ç´¢æ·±ç©¶é…ç½®çš„åŸå› ,æ•¬è¯·çŸ¥æ‚‰~</b>

# hexoå®‰è£…

> é¦–å…ˆè¦ç”¨npmå¤–éƒ¨ä¾èµ–åŒ…ç®¡ç†å·¥å…·å®‰è£…å…¨å±€å‘½ä»¤hexo-cli

    npm install hexo-cli -g

> ç„¶åä½¿ç”¨hexoåˆå§‹åŒ–åšå®¢ç›®å½•,æ¯”å¦‚blogç›®å½•,ç›®å½•åè¦ä¸åç»­è‡ªå·±å»ºç«‹çš„githubä¸Šhexoæ‰˜ç®¡ä»£ç çš„repositoryåŒå

    hexo init blog

> æ¥ç€githubå»ºåº“

   å»ºç«‹ä¸€ä¸ªä»¥white-than-wood(æˆ‘çš„ç”¨æˆ·å).github.ioç»“å°¾çš„repository,ä½œä¸ºhexoæ‰˜ç®¡ä»£ç çš„åº“,githubé»˜è®¤.github.ioç»“å°¾ä½œä¸ºç”¨æˆ·çš„ç½‘ç«™äºŒçº§åŸŸå,å»ºç«‹ä¸€ä¸ªæ–°çš„åˆ†æ”¯ä½œä¸ºåˆ›ä½œåˆ†æ”¯(å› ä¸ºä¸»åˆ†æ”¯æ˜¯ç”¨æ¥å‘å¸ƒå‘ˆç°ç½‘ç«™çš„).

> ä¹‹å,è¿›å…¥ç”Ÿæˆçš„blogæ–‡ä»¶å¤¹,ä¸è¿œç¨‹github repositoryå»ºç«‹å…³è”,å¹¶åŒæ­¥è¿œç¨‹æœ€æ–°èµ„æº

    git remote add origin git@github.com:white-than-wood/white-than-wood.github.io.git
    git pull

> å†npmä¸‹è½½å¤–éƒ¨ä¾èµ–åŒ…

    npm i/npm install

> ä½¿ç”¨yarnä¸‹è½½å¤–éƒ¨ä¾èµ–åŒ…

    yarn

> æœ€åå¯åŠ¨hexoè‡ªèº«æ­å»ºçš„æœåŠ¡,ç”Ÿæˆæœ¬åœ°çš„åšå®¢ç½‘ç«™,é»˜è®¤ç«¯å£åœ¨æœ¬åœ°ipåœ°å€ä¸‹çš„4000ç«¯å£,å‡å¦‚ä½ ä¸æƒ³å¯åŠ¨åœ¨4000ç«¯å£,ä¹Ÿå¯ä½¿ç”¨-p å…¶ä»–ç«¯å£å·è¿›è¡Œé…ç½®,æ¯”å¦‚-p 9977

    hexo server
    hexo server -p 9977

   PS: æœ€å¥½å…ˆå°†æœ¬åœ°ä»£ç ä¸Šä¼ è‡³è¿œç¨‹ä¹‹å,å†æ‰§è¡Œhexoé…ç½®.

    git add .
    git commit 'build:æ­å»ºhexoä¸ªäººGithub Pageåšå®¢'
    git push --set-upstream origin master

> é»˜è®¤çš„ä¸»é¢˜é£æ ¼themeæ˜¯landscape,å‡å¦‚ä½ æƒ³æ›´æ¢,å¯ä»¥é€šè¿‡<a href='https://hexo.io/themes/'>https://hexo.io/themes</a>è¿›è¡Œç­›é€‰,ç­›é€‰ä¹‹åè¿›è¡Œé…ç½®,ä¸»é¢˜é…ç½®è§ä¸‹æ–‡

# hexoå‘½ä»¤

> é¦–å…ˆå»ºç«‹ä¸€ç¯‡åä¸º'hexoæ­å»ºnextåšå®¢'çš„åšå®¢

    hexo new hexoæ­å»ºnextåšå®¢

> åœ¨æ ¹ç›®å½• -> sourceç›®å½•åº•ä¸‹çš„_postç›®å½•ä¸‹æ‰¾åˆ°åä¸ºhexoé…ç½®çš„åšå®¢æ–‡ä»¶,åœ¨é‡Œé¢ç”¨markdownè¿›è¡Œè®°å½•è‡ªå·±çš„åšå®¢,å½“ç„¶å¯ä»¥åœ¨hexo serverè‡ªå¸¦çš„æœåŠ¡å™¨è¿è¡Œç›‘å¬çš„æƒ…å†µä¸‹,è¿›è¡Œæ·»åŠ å’Œä¿®æ”¹è‡ªå·±çš„åšå®¢ã€‚ä¹‹åï¼Œè¿›è¡Œç”Ÿæˆé™æ€æ–‡ä»¶

    hexo generate

> ç”Ÿæˆé™æ€æ–‡ä»¶ä¹‹å,è¿›è¡Œéƒ¨ç½²

    hexo deploy

> ç”Ÿæˆé™æ€æ–‡ä»¶å’Œéƒ¨ç½²å¯ä»¥ä½¿ç”¨ä¸€å¥å‘½ä»¤æ‰§è¡Œ

    hexo generate -deploy
    hexo deploy -generate

> ä¸ºäº†é˜²æ­¢å­˜åœ¨é™æ€æ–‡ä»¶å’Œç¼“å­˜,é€ æˆæ²¡æœ‰é‡æ–°æ¸²æŸ“é¡µé¢çš„é—®é¢˜,åœ¨æ¯ä¸€æ¬¡éƒ¨ç½²ä¹‹å‰,è¦è¿è¡Œä¸€ä¸‹æ¸…ç†é™æ€æ–‡ä»¶å’Œç¼“å­˜çš„å‘½ä»¤

    hexo clean
    hexo generate
    hexo deploy

> hexo deployéƒ¨ç½²ä¹‹å,æ ¹æ®é¡¹ç›®æ ¹ç›®å½•åº•ä¸‹_config.ymlé…ç½®æ–‡ä»¶çš„deployé…ç½®,ä¼šæäº¤åˆ°è¿œç¨‹github repositoryåº“

# hexoé…ç½®

   PS: ä»¥ä¸‹æ‰€è¯´çš„"æ ¹ç›®å½•"æŒ‡çš„å°±æ˜¯å½“å‰åˆ›ä½œçš„repositoryç›®å½•,"ä¸»é¢˜ç›®å½•"å°±æ˜¯æ ¹ç›®å½•ä¸‹/themesç›®å½•ä¸‹çš„ä¸»é¢˜ç¯å¢ƒ.

#### hexo deployå‘å¸ƒé…ç½®

> è¦æƒ³éƒ¨ç½²åˆ°è‡ªå·±æ­å»ºçš„Github Pageä¸ªäººç½‘ç«™,é¦–å…ˆè¦ä¸‹è½½hexo-gitæ’ä»¶

    npm install hexo-deployer-git --save

> ç„¶åå°±è¦åœ¨ä½ è‡ªå·±çš„æœ¬åœ°hexoåšå®¢çš„é¡¹ç›®é‡Œé¢,æ›´æ”¹æ ¹ç›®å½•åº•ä¸‹çš„_config.ymlæ–‡ä»¶,å…¨å±€æœç´¢git,æ›´æ”¹deployå‘å¸ƒé…ç½®,å°†sourceä¸‹é¢çš„å†…å®¹è¿›è¡Œæ„å»ºå‘å¸ƒåˆ°repo githubåœ°å€çš„branchåˆ†æ”¯ä¸Š

    deploy:
        type: git
        #ä½ çš„ä¸ªäººç½‘ç«™githubåº“çš„é“¾æ¥åœ°å€,æœ€å¥½ä½¿ç”¨git:å¼€å¤´çš„,https:å¼€å¤´çš„ä¼šæŠ¥é”™
        repo: git@github.com:dreamthen/dreamthen.github.io.git
        #åˆ†æ”¯å
        branch: master

#### hexo themeä¸»é¢˜é…ç½®

> ç­›é€‰å¥½è‡ªå·±é€‰ä¸­çš„ä¸»é¢˜ä¹‹å,å°±éœ€è¦åœ¨é¡¹ç›®é‡Œé¢è¿›è¡Œé…ç½®æ›´æ¢ã€‚é¦–å…ˆéœ€è¦ä¸‹è½½è¿œç¨‹githubåº“é‡Œé¢çš„ä¸»é¢˜ç›®å½•åˆ°é¡¹ç›®æ ¹ç›®å½•é‡Œé¢çš„themesæ–‡ä»¶å¤¹åº•ä¸‹,æ¯”å¦‚æœ¬äººç”¨çš„æ˜¯nextä¸»é¢˜çš„hexo

    git clone https://github.com/iissnan/hexo-theme-next.git themes/next

> éšåæ›´æ”¹æ ¹ç›®å½•é‡Œé¢çš„_config.ymlæ–‡ä»¶,å…¨å±€æœç´¢theme,æ›´æ”¹themeé…ç½®

    theme: next

> æ¥ç€é€‰æ‹©ä¸»é¢˜å±•ç¤ºçš„æ–¹å¼,éœ€è¦åœ¨ä¸»é¢˜çš„é¡¹ç›®ç›®å½•ä¸‹,æ›´æ”¹_config.ymlæ–‡ä»¶,å…¨å±€æœç´¢Scheme,æ›´æ”¹Schemeé…ç½®,æ¯”å¦‚nextä¸»é¢˜åº•ä¸‹çš„Schemeé…ç½®

    scheme:
        #scheme: Muse
        #scheme: Mist
        scheme: Pisces
        #scheme: Gemini

#### hexo languageè¯­è¨€é…ç½®

> æ¯ä¸ªä¸»é¢˜çš„è¯­è¨€éƒ½æ˜¯æ ¹æ®ä½œè€…çš„æ¯è¯­æ¥é…ç½®çš„,è¦æƒ³é…ç½®å¼€å‘è€…è‡ªå·±å›½å®¶çš„è¯­è¨€,è¿˜æ˜¯æ›´æ”¹é¡¹ç›®æ ¹ç›®å½•åº•ä¸‹çš„_config.ymlæ–‡ä»¶,å…¨å±€æœç´¢language,æ›´æ”¹languageé…ç½®

    language: zh-CN

> å†æ›´æ”¹ä¸»é¢˜ç›®å½•åº•ä¸‹çš„_config.ymlæ–‡ä»¶,å…¨å±€æœç´¢language,æ›´æ”¹languageé…ç½®

    language: zh-CN    

#### hexo pageé¡µé¢é…ç½®

> hexoæä¾›äº†å‡ ä¸ªå¯ä¾›ç­›é€‰çš„é¡µé¢,å¸¸ç”¨çš„æœ‰è¿™ä¹ˆå‡ ä¸ªï¼šhome(é¦–é¡µ)ã€tags(æ ‡ç­¾)ã€about(å…³äºæˆ‘)ã€archives(æ¡£æ¡ˆ)å’Œcategories(åˆ†ç±»),é¦–å…ˆè¦åˆ›å»ºé¡µé¢

    hexo new page tags
    hexo new page about
    hexo new page archives
    hexo new page categories

> æ¥ç€åœ¨ä¸»é¢˜ç›®å½•ä¸‹,æ›´æ”¹_config.ymlæ–‡ä»¶,å…¨å±€æœç´¢menu,æ›´æ”¹menué…ç½®,å½“ç„¶æ¯ä¸ªä¸»é¢˜çš„é…ç½®ä¸å°½ç›¸åŒ

    menu:
        home: / || fa fa-home
        about: /about/ || fa fa-user
        tags: /tags/ || fa fa-tags
        categories: /categories/ || fa fa-th
        archives: /archives/ || fa fa-archive

> éšåæ›´æ”¹sourceç›®å½•åº•ä¸‹åˆ›å»ºçš„é¡µé¢é…ç½®,ä»¥tagsä¸ºä¾‹

    ----------------------------
        title: about
        date: 2018-04-24 17:57:26
        type: "tags"
        comments: false
    ----------------------------

#### hexo avatar å¤´åƒé…ç½®

> é…ç½®è‡ªå·±ä¸ªäººåšå®¢ç½‘ç«™çš„å¤´åƒ,éœ€è¦æ›´æ”¹ä¸»é¢˜ç›®å½•åº•ä¸‹çš„_config.ymlæ–‡ä»¶,æ·»åŠ avataré…ç½®
    
    #å¤´åƒurlé“¾æ¥
    avatar: https://avatars.githubusercontent.com/u/11425476?v=4

#### hexo search å…¨ç«™æœç´¢é…ç½®

> å‡å¦‚æƒ³è¦é…ç½®è‡ªå·±hexoä¸ªäººåšå®¢ç½‘ç«™çš„å…¨ç«™æœç´¢é…ç½®,é¦–å…ˆè¦ä¸‹è½½hexo searchå¤–éƒ¨ä¾èµ–åŒ…

    npm install hexo-generator-search --save
    npm install hexo-generator-searchdb --save

> æ›´æ”¹æ ¹ç›®å½•åº•ä¸‹çš„_config.ymlæ–‡ä»¶,æ·»åŠ searché…ç½®

    search:
        path: search.xml
        field: post
        format: html
        limit: 10000

> å¼€å¯ä¸»é¢˜ç›®å½•åº•ä¸‹çš„_config.ymlæ–‡ä»¶ä¸­çš„local_searché…ç½®

    local_search:
        enable: true        

#### hexo new_post_nameé…ç½®

> å‡å¦‚æƒ³è¦æ›´æ”¹æ¯ä¸€ç¯‡åšå®¢çš„æ–‡ä»¶åç§°,ä¸å†æ˜¯é»˜è®¤çš„:title.mdçš„æ–‡ä»¶å,éœ€è¦æ›´æ”¹æ ¹ç›®å½•åº•ä¸‹çš„_config.ymlæ–‡ä»¶,æ›´æ”¹new_post_nameé…ç½®

    new_post_name: :year-:month-:day-:title.md

#### hexo auto_excerpté˜…è¯»å…¨æ–‡é…ç½®

> åšå®¢æ–‡ç« ä¸€èˆ¬éƒ½ä¼šå¾ˆé•¿çš„,æ‰€ä»¥åœ¨é¦–é¡µè¦å¯¹åšå®¢è¿›è¡Œè¶…é•¿çœç•¥,è¦æƒ³çœ‹æ‰€æœ‰çš„å†…å®¹,ç‚¹å‡»é˜…è¯»å…¨æ–‡æˆ–è€…æ–‡ç« æ ‡é¢˜è¿›å…¥å…¨æ–‡æŸ¥çœ‹,åœ¨hexo-theme-nextä¸»é¢˜ç‰ˆæœ¬7.6ä¹‹å‰éœ€è¦æ›´æ”¹ä¸»é¢˜ç›®å½•åº•ä¸‹çš„_config.ymlæ–‡ä»¶,å…¨å±€æœç´¢auto_excerpt,æ›´æ”¹auto_excerpté…ç½®

    auto_excerpt:
        enable: true
        length: 200

> åœ¨hexo-theme-nextä¸»é¢˜ç‰ˆæœ¬7.6ä¹‹å,ç”±äºauto_excerptè¿™ç§è¶…é•¿çœç•¥ä¸åº”è¯¥æ˜¯ä¸»é¢˜æ’ä»¶åº”è¯¥åšçš„,ä½œè€…å°†æ­¤é…ç½®ç§»é™¤,å¹¶ç»™å‡ºæ–°çš„ä¸“é—¨é’ˆå¯¹æ­¤é…ç½®çš„æ’ä»¶<a href='https://github.com/chekun/hexo-excerpt'>hexo-excerpt</a>

   ![](https://image.white-than-wood.zone/hexo/remove_auto_excerpt.png)

    excerpt:
        #æ˜¾ç¤ºçš„markdownä»£ç å—å±‚æ•°
        depth: 5
        excerpt_excludes: []
        more_excludes: []
        #è®¾ç½®ä¸ºtrue: æ˜¾ç¤ºè¶…é•¿çœç•¥,åªå±•ç¤ºéƒ¨åˆ†,éšè—å…¨æ–‡
        #è®¾ç½®ä¸ºfalse: å±•ç¤ºå…¨æ–‡
        hideWholePostExcerpts: true
        excerpt_description: true
        #æ˜¯å¦æ˜¾ç¤ºé˜…è¯»å…¨æ–‡æŒ‰é’®
        read_more_btn: true

#### hexo browsersyncå¼€å‘ç¯å¢ƒåˆ›ä½œè‡ªåŠ¨æ›´æ–°é…ç½®

> åœ¨åˆ›ä½œåšå®¢æ—¶,éœ€è¦æ¯æ¬¡æ‰‹åŠ¨åˆ·æ–°é¡µé¢æ‰èƒ½çœ‹åˆ°ä¿®æ”¹åçš„ç»“æœ,æ„Ÿè§‰éå¸¸æ²¡æœ‰æ•ˆç‡,å¦‚æœå­˜åœ¨ç±»hrmçƒ­åŠ è½½è¿™ç§æ’ä»¶å°±å¤ªçˆ½äº†!hexo-browsersyncå¯ä»¥ç›´æ¥è§£å†³è¿™ä¸ªé—®é¢˜

æ­¤æ’ä»¶åŸç†åŸºäºbrowser-sync,ä¸hexoå»ºç«‹å…³è”,å½“åˆ›ä½œçš„æ–‡ä»¶å†…å®¹å‘ç”Ÿæ”¹å˜æ—¶,browser-syncå°±ä¼šç›‘å¬åˆ°å¹¶åˆ·æ–°æµè§ˆå™¨æ•´ä¸ªé¡µé¢çš„å†…å®¹,åšåˆ°ä¸éœ€æ‰‹åŠ¨åˆ·æ–°,å¤§å¤§æé«˜äº†åˆ›ä½œæ•ˆç‡.

    #æ›´æ”¹æ ¹ç›®å½•åº•ä¸‹çš„_config.ymlæ–‡ä»¶,æ·»åŠ browsersyncå±æ€§
    #è®¾ç½®ç›‘å¬watchå±æ€§ä¸ºtrueå°±å¯ä»¥äº†!
    browsersync:
        watch: true
        logLevel: "warn"

#### hexo busuanzi_countåœç®—å­ç»Ÿè®¡é…ç½®

> ä¸Šçº¿ä¹‹å,éœ€è¦å¯¹ä¸ªäººåšå®¢è¿›è¡Œç®¡ç†,é˜…è¯»äººæ•°ä»¥åŠæ¬¡æ•°å¯¹äºåˆ›ä½œè€…æ¥è¯´æ˜¯å¾ˆé‡è¦åé¦ˆç‚¹.ç»Ÿè®¡é…ç½®éœ€è¦æ›´æ”¹ä¸»é¢˜ç›®å½•åº•ä¸‹çš„_config.ymlæ–‡ä»¶,é…ç½®busuanzi_countåœç®—å­ç»Ÿè®¡
    
    #å¯é…ç½®æŸ¥çœ‹ä¸ªäººåšå®¢çš„é˜…è¯»äººæ•°ã€æ¬¡æ•°ä»¥åŠæ¯ç¯‡åšå®¢æ–‡ç« çš„æ¬¡æ•°
    busuanzi_count:
        enable: true
        total_visitors: true
        total_visitors_icon: fa fa-user
        total_views: true
        total_views_icon: fa fa-eye
        post_views: true
        post_views_icon: fa fa-eye

#### hexo Gitalkç•™è¨€æ¿é…ç½®

> ç•™è¨€æ¿commentsæ˜¯åˆ›ä½œè€…ä¸é˜…è¯»è€…è¿›è¡Œäº’åŠ¨åé¦ˆçš„çª—å£,å¯ä»¥ä½¿é˜…è¯»è€…ä¸åˆ›ä½œè€…å…±åŒè¿›æ­¥.å¯¹äºhexoæ¥è¯´,æ”¯æŒçš„ç•™è¨€æ¿æ¨¡å¼æœ‰å¾ˆå¤šç§: 'disqus | disqusjs | changyan | livere | gitalk | utterances',æ¯”è¾ƒå¸¸è§ã€ç”¨æˆ·é‡æ¯”è¾ƒå¤§ä¸”ä¸githubå…³è”æ€§æ¯”è¾ƒå¼ºçš„å°±æ˜¯gitalkä»¥åŠdisqus,disquséœ€è¦'æ¢¯å­'ğŸ¶æ‰èƒ½è¯„è®º,é‚£ä¹ˆè¿˜æ˜¯é€‰ç”¨gitalk.ç•™è¨€æ¿é…ç½®éœ€è¦æ›´æ”¹ä¸»é¢˜ç›®å½•ä¸‹çš„_config.ymlæ–‡ä»¶

   é…ç½®comments:
    
    # Multiple Comment System Support
    comments:
        # Available values: tabs | buttons
        style: tabs
        # Choose a comment system to be displayed by default.
        # Available values: disqus | disqusjs | changyan | livere | gitalk | utterances
        active: gitalk
        # Setting `true` means remembering the comment system selected by the visitor.
        storage: true
        # Lazyload all comment systems.
        lazyload: false
        # Modify texts or order for any naves, here are some examples.
        nav:
            gitalk:
                order: -2
            disqus:
                text: Load Disqus
                order: -1

   é…ç½®gitalk:

    # Gitalk
    # For more information: https://gitalk.github.io
    gitalk:
        enable: true
        github_id: white-than-wood # GitHub repo owner
        repo: white-than-wood.github.io # Repository name to store issues
        client_id: 1191ab5290535c1acb09 # GitHub Application Client ID
        client_secret: 8d2cbebac1ae1230f84d1f9f7a36f8008a42c14b # GitHub Application Client Secret
        admin_user: white-than-wood # GitHub repo owner and collaborators, only these guys can initialize gitHub issues
        distraction_free_mode: true # Facebook-like distraction free mode
        # When the official proxy is not available, you can change it to your own proxy address
        proxy: https://shielded-brushlands-08810.herokuapp.com/https://github.com/login/oauth/access_token
        # proxy: https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token # This is official proxy address
        # Gitalk's display language depends on user's browser or system environment
        # If you want everyone visiting your site to see a uniform language, you can set a force language value
        # Available values: en | es-ES | fr | ru | zh-CN | zh-TW
        language: zh-CN

   ä¸Šé¢çš„é…ç½®é¡¹ä¸­æœ‰å‡ ä¸ªéœ€è¦è¯´æ˜çš„ï¼š

   * client_idä¸client_secretæ˜¯Githubçš„OAuthè®¤è¯(ä¸‹ä¸€ä¸ªéƒ¨åˆ†ä¼šä»‹ç»).
   * github_idä¸admin_userè¿™é‡Œå»ºè®®å¡«ä¸€æ ·,å¡«æˆè‡ªå·±çš„githubè´¦å·å(ä¸æ˜¯é‚®ç®±,ä¹Ÿä¸æ˜¯ç”¨æˆ·å).
   * proxyé»˜è®¤å³æ˜¯ä¸Šé¢çš„åœ°å€,å®ƒå…¶å®ä¼šå›è°ƒåˆ°è¿™é‡Œ<a href='https://github.com/login/oauth/access_token'>https://github.com/login/oauth/access_token</a>æ¥,å‡º403çš„é—®é¢˜,ä¸»è¦æ˜¯ç”±äºè·¨åŸŸ.

> Githubçš„OAuthè®¤è¯

   å‰ææ˜¯è‡ªå·±å¾—æœ‰ä¸€ä¸ªgithubè´¦å·,æ‰èƒ½æ³¨å†ŒOAuth application,è¿™æ˜¯<a href='https://github.com/settings/applications/new'>OAuthåº”ç”¨æ³¨å†Œåœ°å€</a>.

   ![](https://image.white-than-wood.zone/hexo/github_auth_register.png)

   æ³¨å†Œä¹‹å,ç‚¹å‡»ä¸‹å›¾ä¸­'Generate a new client secret'æŒ‰é’®,åœ¨ä¸ªäººè´¦å·ä¸‹çš„Settings -> Developer settings -> OAuth Appsä¸‹é¢å¯ä»¥æŸ¥çœ‹OAuthè®¤è¯client_idä¸client_secret.

   ![](https://image.white-than-wood.zone/hexo/developer_settings.png)

> Gitalkè‡ªåŠ¨åˆå§‹åŒ–

   åŸç†: é€šè¿‡sitemapä¸­çš„ä¿¡æ¯,è¯·æ±‚githubå¼€æ”¾apiè¾¾åˆ°è‡ªåŠ¨äº§ç”Ÿissuesçš„ç›®çš„.
   åŸºæœ¬çš„è¦æ±‚: github APIéœ€è¦è¯·æ±‚token.

   * ç”³è¯·github Token.

   æˆ‘ä»¬éœ€è¦ä½¿ç”¨Personal access tokensæ–¹å¼,è¿™ç§æ–¹å¼é™åˆ¶æ¯å°æ—¶5000æ¬¡,ç»“åˆç¼“å­˜åŠŸèƒ½,åŸºæœ¬æ»¡è¶³éœ€æ±‚.
   ä»Githubçš„<a href='https://github.com/settings/tokens'>Personal access tokens</a>é¡µé¢,ç‚¹å‡»<a href='https://github.com/settings/tokens/new'>Generate new token</a>.

   ![](https://image.white-than-wood.zone/hexo/access_tokens.png)

   * å®‰è£…npmä¾èµ–é¡¹.

    npm i -D md5 moment request xml-parser
    npm i -S hexo-generator-sitemap

   * é…ç½®sitemap.

   åœ¨æ ¹ç›®å½•ä¸­åˆ›å»ºsitemap_template.xml.

   ```xml
<?xml version="1.0" encoding="UTF-8"?>
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
  {% for post in posts %}
  <url>
    <loc>{{ post.permalink | uriencode }}</loc>
    {% if post.updated %}
    <lastmod>{{ post.updated.toISOString() }}</lastmod>
    {% elif post.date %}
    <lastmod>{{ post.date.toISOString() }}</lastmod>
    {% endif %}
    <date>{{ post.date }}</date>
    <title>{{ post.title + ' | ' + config.title }}</title>
    {# nunjucks æ¨¡ç‰ˆè¯­æ³• https://github.com/mozilla/nunjucks #}
    <desc>{{ post.description | default(post.excerpt) | default(post.content) | default(config.description) | striptags | truncate(200, true, '') }}</desc>
  </url>
  {% endfor %}
</urlset>
   ```

   * ä¿®æ”¹æ ¹ç›®å½•ä¸‹çš„_config.yml.

    #Sitemap
    sitemap:
        path: sitemap.xml
        template: ./sitemap_template.xml
        rel: false
        tag: true
        category: false

   * ç”Ÿæˆsitemap.xmlæ–‡ä»¶.

    hexo clean && hexo generate

   * æ ¹ç›®å½•æ·»åŠ talk-auto-init.js(æ³¨æ„è¿˜æ˜¯ä¸è¦å°†æ­¤æ–‡ä»¶ç½®äºgithubä¸­,å»ºè®®ignore).

   ```javascript
const fs = require('fs');
const path = require('path');
const url = require('url');

const request = require('request');
const xmlParser = require('xml-parser');
const md5 = require('md5');

// é…ç½®ä¿¡æ¯
const config = {
  username: 'white-than-wood', // GitHub repository æ‰€æœ‰è€…ï¼Œå¯ä»¥æ˜¯ä¸ªäººæˆ–è€…ç»„ç»‡ã€‚å¯¹åº”Gitalké…ç½®ä¸­çš„owner
  repo: "white-than-wood.github.io", // å‚¨å­˜è¯„è®ºissueçš„githubä»“åº“åï¼Œä»…éœ€è¦ä»“åº“åå­—å³å¯ã€‚å¯¹åº” Gitalké…ç½®ä¸­çš„repo
  token: 'ghp_EuXHDkOxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', // å‰é¢ç”³è¯·çš„ personal access token
  sitemap: path.join(__dirname, './public/sitemap.xml'), // è‡ªå·±ç«™ç‚¹çš„ sitemap æ–‡ä»¶åœ°å€
  cache: true, // æ˜¯å¦å¯ç”¨ç¼“å­˜ï¼Œå¯ç”¨ç¼“å­˜ä¼šå°†å·²ç»åˆå§‹åŒ–çš„æ•°æ®å†™å…¥é…ç½®çš„ gitalkCacheFile æ–‡ä»¶ï¼Œä¸‹ä¸€æ¬¡ç›´æ¥é€šè¿‡ç¼“å­˜æ–‡ä»¶åˆ¤æ–­
  gitalkCacheFile: path.join(__dirname, './gitalk-init-cache.json'), // ç”¨äºä¿å­˜ gitalk å·²ç»åˆå§‹åŒ–çš„ id åˆ—è¡¨
  gitalkErrorFile: path.join(__dirname, './gitalk-init-error.json'), // ç”¨äºä¿å­˜ gitalk åˆå§‹åŒ–æŠ¥é”™çš„æ•°æ®
};

const api = 'https://api.github.com/repos/' + config.username + '/' + config.repo + '/issues';

/**
 * è¯»å– sitemap æ–‡ä»¶
 * è¿œç¨‹ sitemap æ–‡ä»¶è·å–å¯å‚è€ƒ https://www.npmjs.com/package/sitemapper
 */
const sitemapXmlReader = (file) => {
  try {
    const data = fs.readFileSync(file, 'utf8');
    const sitemap = xmlParser(data);
    let ret = [];
    sitemap.root.children.forEach(function (url) {
      const loc = url.children.find(function (item) {
        return item.name === 'loc';
      });
      if (!loc) {
        return false;
      }
      const title = url.children.find(function (item) {
        return item.name === 'title';
      });
      const desc = url.children.find(function (item) {
        return item.name === 'desc';
      });
      const date = url.children.find(function (item) {
        return item.name === 'date';
      });
      ret.push({
        url: loc.content,
        title: title.content,
        desc: desc.content,
        date: date.content,
      });
    });
    return ret;
  } catch (e) {
    return [];
  }
};

// è·å– gitalk ä½¿ç”¨çš„ id
const getGitalkId = ({
                       url: u,
                       date
                     }) => {
  const link = url.parse(u);
  // é“¾æ¥ä¸å­˜åœ¨ï¼Œä¸éœ€è¦åˆå§‹åŒ–
  if (!link || !link.pathname) {
    return false;
  }
  if (!date) {
    return false;
  }
  return md5(link.pathname);
};

/**
 * é€šè¿‡ä»¥è¯·æ±‚åˆ¤æ–­æ˜¯å¦å·²ç»åˆå§‹åŒ–
 * @param {string} gitalk åˆå§‹åŒ–çš„id
 * @return {[boolean, boolean]} ç¬¬ä¸€ä¸ªå€¼è¡¨ç¤ºæ˜¯å¦å‡ºé”™ï¼Œç¬¬äºŒä¸ªå€¼ false è¡¨ç¤ºæ²¡åˆå§‹åŒ–ï¼Œ true è¡¨ç¤ºå·²ç»åˆå§‹åŒ–
 */
const getIsInitByRequest = (id) => {
  const options = {
    headers: {
      'Authorization': 'token ' + config.token,
      'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36',
      'Accept': 'application/json'
    },
    url: api + '?labels=' + id + ',Gitalk',
    method: 'GET'
  };
  return new Promise((resolve) => {
    request(options, function (err, response, body) {
      if (err) {
        return resolve([err, false]);
      }
      if (response.statusCode != 200) {
        return resolve([response, false]);
      }
      const res = JSON.parse(body);
      if (res.length > 0) {
        return resolve([false, true]);
      }
      return resolve([false, false]);
    });
  });
};

/**
 * é€šè¿‡ç¼“å­˜åˆ¤æ–­æ˜¯å¦å·²ç»åˆå§‹åŒ–
 * @param {string} gitalk åˆå§‹åŒ–çš„id
 * @return {boolean} false è¡¨ç¤ºæ²¡åˆå§‹åŒ–ï¼Œ true è¡¨ç¤ºå·²ç»åˆå§‹åŒ–
 */
const getIsInitByCache = (() => {
  // åˆ¤æ–­ç¼“å­˜æ–‡ä»¶æ˜¯å¦å­˜åœ¨
  let gitalkCache = false;
  try {
    gitalkCache = require(config.gitalkCacheFile);
  } catch (e) {}
  return function (id) {
    if (!gitalkCache) {
      return false;
    }
    if (gitalkCache.find(({
                            id: itemId
                          }) => (itemId === id))) {
      return true;
    }
    return false;
  };
})();

// æ ¹æ®ç¼“å­˜ï¼Œåˆ¤æ–­é“¾æ¥æ˜¯å¦å·²ç»åˆå§‹åŒ–
// ç¬¬ä¸€ä¸ªå€¼è¡¨ç¤ºæ˜¯å¦å‡ºé”™ï¼Œç¬¬äºŒä¸ªå€¼ false è¡¨ç¤ºæ²¡åˆå§‹åŒ–ï¼Œ true è¡¨ç¤ºå·²ç»åˆå§‹åŒ–
const idIsInit = async (id) => {
  if (!config.cache) {
    return await getIsInitByRequest(id);
  }
  // å¦‚æœé€šè¿‡ç¼“å­˜æŸ¥è¯¢åˆ°çš„æ•°æ®æ˜¯æœªåˆå§‹åŒ–ï¼Œåˆ™å†é€šè¿‡è¯·æ±‚åˆ¤æ–­æ˜¯å¦å·²ç»åˆå§‹åŒ–ï¼Œé˜²æ­¢å¤šæ¬¡åˆå§‹åŒ–
  if (getIsInitByCache(id) === false) {
    return await getIsInitByRequest(id);
  }
  return [false, true];
};

// åˆå§‹åŒ–
const gitalkInit = ({
                      url,
                      id,
                      title,
                      desc
                    }) => {
  //åˆ›å»ºissue
  const reqBody = {
    'title': title,
    'labels': [id, 'Gitalk'],
    'body': url + '\r\n\r\n' + desc
  };

  const options = {
    headers: {
      'Authorization': 'token ' + config.token,
      'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36',
      'Accept': 'application/json',
      'Content-Type': 'application/json;charset=UTF-8'
    },
    url: api,
    body: JSON.stringify(reqBody),
    method: 'POST'
  };
  return new Promise((resolve) => {
    request(options, function (err, response, body) {
      if (err) {
        return resolve([err, false]);
      }
      if (response.statusCode != 201) {
        return resolve([response, false]);
      }
      return resolve([false, true]);
    });
  });
};


/**
 * å†™å…¥å†…å®¹
 * @param {string} fileName æ–‡ä»¶å
 * @param {string} content å†…å®¹
 */
const write = async (fileName, content, flag = 'w+') => {
  return new Promise((resolve) => {
    fs.open(fileName, flag, function (err, fd) {
      if (err) {
        resolve([err, false]);
        return;
      }
      fs.writeFile(fd, content, function (err) {
        if (err) {
          resolve([err, false]);
          return;
        }
        fs.close(fd, (err) => {
          if (err) {
            resolve([err, false]);
            return;
          }
        });
        resolve([false, true]);
      });
    });
  });
};

const init = async () => {
  const urls = sitemapXmlReader(config.sitemap);
  // æŠ¥é”™çš„æ•°æ®
  const errorData = [];
  // å·²ç»åˆå§‹åŒ–çš„æ•°æ®
  const initializedData = [];
  // æˆåŠŸåˆå§‹åŒ–æ•°æ®
  const successData = [];
  for (const item of urls) {
    const {
      url,
      date,
      title,
      desc
    } = item;
    const id = getGitalkId({
      url,
      date
    });
    if (!id) {
      console.log(`id: ç”Ÿæˆå¤±è´¥ [ ${id} ] `);
      errorData.push({
        ...item,
        info: 'id ç”Ÿæˆå¤±è´¥',
      });
      continue;
    }
    const [err, res] = await idIsInit(id);
    if (err) {
      console.log(`Error: æŸ¥è¯¢è¯„è®ºå¼‚å¸¸ [ ${title} ] , ä¿¡æ¯ï¼š`, err || 'æ— ');
      errorData.push({
        ...item,
        info: 'æŸ¥è¯¢è¯„è®ºå¼‚å¸¸',
      });
      continue;
    }
    if (res === true) {
      // console.log(`--- Gitalk å·²ç»åˆå§‹åŒ– --- [ ${title} ] `);
      initializedData.push({
        id,
        url,
        title,
      });
      continue;
    }
    console.log(`Gitalk åˆå§‹åŒ–å¼€å§‹... [ ${title} ] `);
    const [e, r] = await gitalkInit({
      id,
      url,
      title,
      desc
    });
    if (e || !r) {
      console.log(`Error: Gitalk åˆå§‹åŒ–å¼‚å¸¸ [ ${title} ] , ä¿¡æ¯ï¼š`, e || 'æ— ');
      errorData.push({
        ...item,
        info: 'åˆå§‹åŒ–å¼‚å¸¸',
      });
      continue;
    }
    successData.push({
      id,
      url,
      title,
    });
    console.log(`Gitalk åˆå§‹åŒ–æˆåŠŸ! [ ${title} ] - ${id}`);
    continue;
  }

  console.log(''); // ç©ºè¾“å‡ºï¼Œç”¨äºæ¢è¡Œ
  console.log('--------- è¿è¡Œç»“æœ ---------');
  console.log(''); // ç©ºè¾“å‡ºï¼Œç”¨äºæ¢è¡Œ

  if (errorData.length !== 0) {
    console.log(`æŠ¥é”™æ•°æ®ï¼š ${errorData.length} æ¡ã€‚å‚è€ƒæ–‡ä»¶ ${config.gitalkErrorFile}ã€‚`);
    await write(config.gitalkErrorFile, JSON.stringify(errorData, null, 2));
  }

  console.log(`æœ¬æ¬¡æˆåŠŸï¼š ${successData.length} æ¡ã€‚`);

  // å†™å…¥ç¼“å­˜
  if (config.cache) {
    console.log(`å†™å…¥ç¼“å­˜ï¼š ${(initializedData.length + successData.length)} æ¡ï¼Œå·²åˆå§‹åŒ– ${initializedData.length} æ¡ï¼Œæœ¬æ¬¡æˆåŠŸï¼š ${successData.length} æ¡ã€‚å‚è€ƒæ–‡ä»¶ ${config.gitalkCacheFile}ã€‚`);
    await write(config.gitalkCacheFile, JSON.stringify(initializedData.concat(successData), null, 2));
  } else {
    console.log(`å·²åˆå§‹åŒ–ï¼š ${initializedData.length} æ¡ã€‚`);
  }
};

init();
   ```

   * ä¿®æ”¹package.jsonä¸­scriptsä¸­çš„è„šæœ¬,æ·»åŠ "gitalk":"node talk-auto-init.js".

   ```json
{
   "scripts": {
      "build": "hexo generate",
      "clean": "hexo clean",
      "deploy": "hexo deploy",
      "server": "hexo server",
      "publish": "git push && hexo clean && hexo generate -deploy",
      "gitalk": "node talk-auto-init.js"
   }
}
   ```

   * æµ‹è¯•gitalk.

    npm run talk

   * å·²ç»ç¼“å­˜è¿‡åçš„ç»“æœ:

    > hexo-site@0.0.0 gitalk
    > node talk-auto-init.js


    --------- è¿è¡Œç»“æœ ---------

    æœ¬æ¬¡æˆåŠŸï¼š 0 æ¡ã€‚
    å†™å…¥ç¼“å­˜ï¼š 7 æ¡ï¼Œå·²åˆå§‹åŒ– 7 æ¡ï¼Œæœ¬æ¬¡æˆåŠŸï¼š 0 æ¡ã€‚å‚è€ƒæ–‡ä»¶ /Users/yinwk/keryi/white-than-wood.github.io/gitalk-init-cache.json.

> proxy 403é”™è¯¯

   * nginxè§£å†³æ–¹æ¡ˆ(æ¨è).

   åœ¨nginxçš„åšå®¢é…ç½®ä¸­åŠ å…¥å¦‚ä¸‹å†…å®¹(æ³¨æ„è‡ªå·±åšå®¢çš„åŸŸåå¿…é¡»ç»è¿‡https sslå®‰å…¨è¯ä¹¦å¤‡æ¡ˆ,Github Pagesä¸æ”¯æŒè‡ªå®šä¹‰åŸŸåæ·»åŠ SSLè¯ä¹¦,è¦æƒ³ä½¿ç”¨æ­¤è§£å†³æ–¹æ¡ˆ,å¿…é¡»ä½¿ç”¨è‡ªå·±ç”³è¯·çš„åŸŸå,å¹¶ä¸”é€šè¿‡https sslå®‰å…¨è¯ä¹¦å¤‡æ¡ˆ,æœ€ååœ¨Githubä»¥åŠç”³è¯·å’Œç®¡ç†åŸŸåçš„å¹³å°ä¸Šè®¾ç½®è‡ªå®šä¹‰åŸŸå):

   ```shell
server {
    listen 443 ssl http2;

    location = /login/oauth/access_token {
        add_header Access-Control-Allow-Origin 'https://white-than-wood.github.io/';  //è¿™é‡Œæ”¹æˆä½ è‡ªå·±çš„åŸŸå,å¹¶åˆ é™¤æ³¨é‡Š
        add_header Access-Control-Allow-Methods 'GET, POST, OPTIONS';
        add_header Access-Control-Allow-Headers 'DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization';
        if ($request_method = 'OPTIONS') {
              return 204;
        }
        proxy_pass https://github.com;
    }
}
  ```

   * è‡ªå»ºä¸€ä¸ªworkers.

   åœ°å€: <a href='https://workers.cloudflare.com/'>CloudFlare Workers</a>
   å‚è€ƒæ–‡ç« : <a href='https://blog.dsrkafuu.net/post/2020/cloudflare-worker-cors-anywhere/'>ä½¿ç”¨CloudFlare Workerså®ç°CORS Anywhere</a>

   * ä½¿ç”¨å…¶ä»–äººæ­å»ºçš„ä»£ç†.

   æ¯”å¦‚è¿™ä¸ª<a href='https://github.com/gitalk/gitalk/issues/429#issuecomment-778291781'>issues</a>ä»‹ç»åˆ°çš„:

    proxy: https://shielded-brushlands-08810.herokuapp.com/https://github.com/login/oauth/access_token

#### hexo å…¶ä»–é…ç½®

> æ›´æ”¹æ ¹ç›®å½•åº•ä¸‹çš„_config.ymlæ–‡ä»¶,æ›´æ”¹ç½‘ç«™title(æ ‡é¢˜)ã€author(ä½œè€…)ã€keywords(å…³é”®å­—)ã€description(æè¿°)é…ç½®,æ¯”å¦‚æœ¬äººçš„é…ç½®

    title: WTW's Frontend
    author: WTW(æ¯”æœ¨ç™½)
    keywords: hexo,hexo-cli,hexoåšå®¢,hexoåšå®¢ä¸ªäººç½‘ç«™,hexo blog
    subtitle: é“é˜»ä¸”é•¿,è¡Œåˆ™å°†è‡³
    description: å‰ç«¯é¢†åŸŸå†…æ‰€ä¸çŸ¥é“çš„éƒ½æ¢ç´¢äºæ­¤!

> æ›´æ”¹ä¸»é¢˜ç›®å½•åº•ä¸‹çš„_config.ymlæ–‡ä»¶,è®¾ç½®ä¸ªäººçš„github(githubæ‰˜ç®¡ä»£ç ç½‘å€)ã€google(googleä¸ªäººèµ„æ–™ç½‘å€)ã€gmail(gmailé‚®ç®±ç½‘å€)ã€twitter(twitterä¸ªäººå¾®åšç½‘å€)ç­‰ç­‰,æ¯”å¦‚æœ¬äººçš„é…ç½®

    social:
      GitHub: https://github.com/white-than-wood || fab fa-github
      E-Mail: https://dreamthen.00@gmail.com || fab fa-envelope
      Google: https://plus.google.com/u/0/103833130011211353424 || fab fa-google

> å‘å¸ƒåˆ°GitHub Pageä¸Šä¹‹å,ä½ ä¼šå‘ç°README.mdè«åçš„æ¶ˆå¤±,ä¸»è¦æ˜¯å› ä¸ºhexoæ„å»ºå‘å¸ƒåˆ°è¿œç¨‹çš„ç›®å½•åªæ˜¯sourceç›®å½•,æ‰€ä»¥åªè¦å°†README.md copyä¸€ä»½æ”¾åˆ°sourceç›®å½•ä¸‹,å¹¶ä¸”é…ç½®æ¸²æŸ“æ—¶è·³è¿‡çš„markdownç±»å‹æ–‡ä»¶å°±å¯ä»¥äº†
    
    #hexoæ„å»ºæ¸²æŸ“æ—¶ä¼šå°†sourceç›®å½•ä¸‹markdownç±»å‹æ–‡ä»¶è½¬è¯‘ä¸ºhtml,æˆ‘ä»¬ä¸éœ€è¦å°†README.mdè½¬è¯‘,æ‰€ä»¥ç›´æ¥skip render
    #æ›´æ”¹æ ¹ç›®å½•åº•ä¸‹çš„_config.ymlæ–‡ä»¶,ä¿®æ”¹skip_renderå±æ€§
    skip_render: README.md

> å½“åˆ›ä½œä¸­å›¾ç‰‡è¿‡å°,é˜…è¯»è€…æ— æ³•çœ‹æ¸…çš„æƒ…å†µä¸‹,æ”¾å¤§é…ç½®å°±å·²ç„¶æˆä¸ºå¿…è¦.fancyboxé…ç½®å¯ä»¥ç‚¹å‡»ä½¿å›¾ç‰‡æ”¾å¤§,å¹¶å¯åŒæ—¶æŸ¥çœ‹å…¨æ–‡çš„å›¾ç‰‡.æ›´æ”¹ä¸»é¢˜ç›®å½•ä¸‹çš„_config.ymlæ–‡ä»¶fancyboxå±æ€§

    # FancyBox is a tool that offers a nice and elegant way to add zooming functionality for images.
    # For more information: https://fancyapps.com/fancybox/
    fancybox: true